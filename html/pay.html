<!DOCTYPE html>
<html>
<link href="./css/override.css" rel="stylesheet">

<head>

</head>

<body>
  <div>
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a href="javascript:loadMainPage();">หน้าหลัก</a>
      </li>
      <li class="breadcrumb-item">
        <a href="javascript:loadRecClassPage();" id="breadcrumrecclassdetail">รายการแนะนำงานสอนเลขที่ </a>
      </li>
      <li class="breadcrumb-item active" id="breadcrumbpayment">รายการชำระเงินเลขที่ </li>
    </ol>
  </div>
  <br>
  <div class="alert alert-dismissible alert-success" style="display: none;">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    <strong>บันทึกข้อมูลสำเร็จ</strong>
  </div>
  <div class="alert alert-dismissible alert-danger" style="display: none;">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    <strong>ไม่สามารถบันทึกข้อมูลได้</strong>
  </div>

  <div class="label-header" id="headerpayment">รายการชำระเงินเลขที่</div>
  <div>
    <table class="table table-hover" id="paymenttable">
      <tr class="table-primary" align="center">
        <th scope="col">รายการที่</th>
        <th scope="col">รหัสงานสอน</th>
        <th scope="col">วิชาและระดับชั้น</th>
        <th scope="col">วัน เวลาและสถานที่สอน</th>
        <th scope="col">จำนวนชั่วโมง</th>
        <th scope="col">ค่าแนะนำต่อชั่วโมง</th>
        <th scope="col">ค่าแนะนำ</th>
      </tr>
    </table>
  </div>
  <div>
    <br>
  </div>
  <div class="text-center">
    <button type="button" class="btn btn-success btn-lg" onClick="javascript:payment();">ยืนยันการชำระเงิน</button>
    <button type="button" class="btn btn-danger btn-lg">ปฏิเสธงานสอน</button>
  </div>
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
    Launch demo modal
  </button>

  <!-- Modal -->
  <div class="modal fade" id="modalConfirmPayment" tabindex="-1" role="dialog" aria-labelledby="confirmPaymentLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="confirmPaymentLabel">ยืนยันการชำระเงิน</h4>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>

        </div>
        <div class="modal-body" id="divConfirmPaymentLabel">
          ท่านต้องการยืนยันการชำระเงินงานสอนรหัส
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default btn-lg" data-dismiss="modal">ยกเลิก</button>
          <button type="button" class="btn btn-primary btn-lg">ยืนยันการชำระเงิน</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    jQuery(document).ready(function () {
      console.log("ready!");
      if (_gUser.turId != null) {

        setUpTable();
      }
    });

    function loadRecClassPage() {
      _selectedRecId = _gRec.recId;
      $('#divConfirmPaymentLabel').text('ท่านต้องการยืนยันการชำระเงินงานสอนเลขที่ '+ _selectedRecId)
      $('#herderpayment').text('รายการรายการชำระเงินเลขที่ ' + _selectedRecId);
      $('#breadcrumbpayment').text('รายการรายการชำระเงินเลขที่ ' + _selectedRecId);
      $('#breadcrumrecclassdetail').text('รายการแนะนำงานสอนเลขที่ ' + _selectedRecId);
      if (_gRec.recType == 'M') {
        jQuery("#divMainContainer").load('./html/mergedclassdetail.html');
      } else {
        jQuery("#divMainContainer").load('./html/classdetail.html');
      }
    }
    function setUpTable() {
      var url = "http://localhost:8080/tutormatchingservices-0.0.1-SNAPSHOT/rectutor/paymentlist/" + _gRec.recId
      console.log(url);
      $.getJSON(url, function (json_data) {
        console.log(json_data);
        var classes = json_data.data.classViews;
        console.log(classes);
        var table_obj = $('#paymenttable');
        var totalRecPrice = 0;
        if (json_data.data.size != 0) {
          $.each(classes, function (index, result) {
            var table_row = $('<tr>', {});
            var table_cell1 = $('<td>', { html: index + 1 });
            table_cell1.attr("align", "center");
            var table_cell2 = $('<td>', { html: result.clsId });
            table_cell2.attr("align", "center");
            var table_cell3 = $('<td>', { html: result.subjectAndGroupDetailName });
            var table_cell4 = $('<td>', { html: result.recTimeLoc });
            var table_cell5 = $('<td>', { html: result.hours });
            table_cell5.attr("align", "center");
            var table_cell6 = $('<td>', { html: result.recPricePerHour });
            table_cell6.attr("align", "right");
            var table_cell7 = $('<td>', { html: result.recPrice });
            table_cell7.attr("align", "right");
            totalRecPrice = totalRecPrice + result.recPrice;
            table_row.append(table_cell1, table_cell2, table_cell3, table_cell4, table_cell5, table_cell6, table_cell7);
            table_obj.append(table_row);
          });
          var table_row = $('<tr class="table-active">', {});
          var table_cell1 = $('<td>', {});
          var table_cell2 = $('<td>', {});
          var table_cell3 = $('<td>', {});
          var table_cell4 = $('<td>', {});
          var table_cell5 = $('<td>', {});
          var table_cell6 = $('<td>', {});
          var table_cell7 = $('<td>', { html: '<strong>' + json_data.data.totalRecPrice + '</strong>' });
          table_cell7.attr("align", "right");
          table_row.append(table_cell1, table_cell2, table_cell3, table_cell4, table_cell5, table_cell6, table_cell7);
          table_obj.append(table_row);
        } else {
          $('#paymenttable').hide();
        }

      });
    }
    function payment() {
      var requestBody = {
        recId: _gRec.recId
      };
      $.ajax({
        type: "POST",
        url: "http://localhost:8080/tutormatchingservices-0.0.1-SNAPSHOT/rectutor/accept",
        data: JSON.stringify(requestBody),
        contentType: "application/json; charset=utf-8",
        crossDomain: true,
        dataType: "json",
        success: function (data, status, jqXHR) {

          console.log("Payment Success");


        },

        error: function (jqXHR, status) {
          // error handler
          console.log(jqXHR);
          alert('fail' + status.code);
        }
      });
    }
  </script>
</body>

</html>