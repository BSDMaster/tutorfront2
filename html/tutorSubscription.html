<!DOCTYPE html>
<html>

<head>
    <!--    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC3CqYZxIposJwTiB-GAGSYBRRHIi0x6_Y&libraries=places&language=en"></script>
-->
</head>

<body>
    <div>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="javascript:loadMainPage();">หน้าหลัก</a>
            </li>
            <li class="breadcrumb-item active">สมัครสมาชิกติวเตอร์</li>
        </ol>
    </div>
    <br>

    <div class="alert alert-dismissible alert-success" style="display: none;">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <strong>บันทึกข้อมูลสำเร็จ</strong>
    </div>
    <div class="alert alert-dismissible alert-danger" style="display: none;">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <strong>ไม่สามารถบันทึกข้อมูลได้</strong>
    </div>
    <div class="label-header">สมัครสมาชิกติวเตอร์</div>
    <br>
    <br>
    <div class="container-fluid">
        <div class="row" style="padding-left: 30px;">
            <div class="col-lg-12">
                <form class="form-horizontal">
                    <div class="form-group required">
                        <label for="txtEmail" class="col-lg-2 labelform">อีเมล์</label>
                        <div class="col-lg-4">
                            <input type="text" class="form-control" id="txtEmail">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required">
                        <label for="txtNewPassword" class="col-lg-2 labelform">รหัสผ่านใหม่</label>
                        <div class="col-lg-4">
                            <input type="password" class="form-control" id="txtNewPassword">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required">
                        <label for="txtConfirmPassword" class="col-lg-2 labelform">ยืนยันรหัสผ่าน</label>
                        <div class="col-lg-4">
                            <input type="password" class="form-control" id="txtConfirmPassword">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="h2 inner-tab">ข้อมูลส่วนตัว</div>
    <br>
    <div class="container-fluid">
        <div class="row" style="padding-left: 30px;">
            <div class="col-lg-12">
                <form class="form-horizontal">
                    <div class="form-group required">
                        <label for="txtFirstName" class="col-lg-2 labelform">ชื่อ</label>
                        <div class="col-lg-4">
                            <input type="text" class="form-control" id="txtFirstName">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required">
                        <label for="txtLastName" class="col-lg-2 labelform">นามสกุล</label>
                        <div class="col-lg-4">
                            <input type="text" class="form-control" id="txtLastName">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group">
                        <label for="txtNickname" class="col-lg-2">ชื่อเล่น</label>
                        <div class="col-lg-4">
                            <input type="text" class="form-control" id="txtNickname">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required">
                        <label for="txtTel" class="col-lg-2 labelform">เบอร์โทรมือถือ</label>
                        <div class="col-lg-4">
                            <input type="text" class="form-control" id="txtTel" pattern="^[0-9]*$">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required">
                        <label for="dropdownSex" class="col-lg-2 labelform">เพศ</label>
                        <div class="col-lg-4">
                            <select class="custom-select" id="dropdownSex" required></select>
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required">
                        <label for="dropdownUniversity" class="col-lg-2 labelform">สถาบันศึกษา</label>
                        <div class="col-lg-4">
                            <select class="custom-select" id="dropdownUniversity" required></select>
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required">
                        <label for="dropdownFaculty" class="col-lg-2 labelform">คณะ</label>
                        <div class="col-lg-4">
                            <select class="custom-select" id="dropdownFaculty" required></select>
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group">
                        <label for="pickerBirthdate" class="col-lg-2">วัน เดือน ปีเกิด</label>
                        <div class="col-lg-4">
                            <div class="input-group">
                                <div class="input-group-addon">
                                    <div class="fa fa-calendar-times-o"></div>
                                </div>
                                <input class="form-control" id="pickerBirthdate" name="date" placeholder="DD/MM/YYYY" type="text" />
                            </div>
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group">
                        <label for="" class="col-lg-2">เอกสารสำเนาบัตรประชาชน</label>
                        <div class="col-lg-4">
                            <input type="file" class="form-control-file" id="inputIDCardFile">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group">
                        <label for="txtAddress" class="col-lg-2 ">ที่อยู่ปัจจุบัน</label>
                        <div class="col-lg-4">
                            <textarea class="form-control" id="txtAddress" rows="3"></textarea>
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group">
                        <label for="txtClip" class="col-lg-2">คลิปตัวอย่างงานสอน</label>
                        <div class="col-lg-4">
                            <input type="text" class="form-control" id="txtClip">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group">
                        <label for="txtOthers" class="col-lg-2">ข้อมูลงานสอนเพิ่มเติม</label>
                        <div class="col-lg-4">
                            <textarea class="form-control" id="txtOthers" rows="3"></textarea>
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <br>
                    <br>
                </form>
            </div>
        </div>
    </div>
    <div class="container-center">
        <p>
            <button type="button" class="btn btn-primary btn-lg" id="btnAddTutor">บันทึก</button>
            <button type="button" class="btn btn-secondary btn-lg">ยกเลิก</button>
        </p>
    </div>
    </div>
    <br>
    <br>
    <br>
    <script>
        /*----------- PAGE 1 -------------*/
        var dataSex = [{
            name: "ชาย", val: "M"
        }, {
            name: "หญิง", val: "F"
        }];
        for (var i = 0; i < dataSex.length; i++) {
            $('#dropdownSex').append('<option value="' + dataSex[i].val + '">' + dataSex[i].name + '</option>');
        }
        var dataUniversities = [];
        var dataFaculties = [];

        jQuery(document).ready(function () {
            var date_input = $('input[name="date"]'); //our date input has the name "date"
            var container = $('.bootstrap-iso form').length > 0 ? $('.bootstrap-iso form').parent() : "body";
            date_input.datepicker({
                format: 'dd/mm/yyyy',
                container: container,
                todayHighlight: true,
                autoclose: true,
            })
            if (_gFBUser.email) {
                $('#txtFirstName').val(_gFBUser.firstName);
                $('#txtLastName').val(_gFBUser.lastName);
                $('#txtEmail').val(_gFBUser.email);
                $('#txtNewPassword').hide();
                $('#txtConfirmPassword').hide();
            }
            initialUniversities();
        });

        function initialUniversities() {
            dataUniversities = [];
            console.log("initial universities list");
            $.ajax({
                type: "GET",
                url: _gServiceURL + "facultyofuniversity/list",
                contentType: "application/json; charset=utf-8",
                crossDomain: true,
                dataType: "json",
                success: function (data, status, jqXHR) {
                    console.log(data.data.universityViews);
                    var messages = data.message;
                    var alert;
                    if (data.status == 200) {
                        dataUniversities = data.data.universityViews;
                        for (var i = 0; i < dataUniversities.length; i++) {
                            $('#dropdownUniversity').append('<option value="' + dataUniversities[i].uniId + '">' + dataUniversities[i].uniName + '</option>');
                        }
                        if (dataUniversities[0]) {
                            var dataFaculties = dataUniversities[0].faculties;
                            console.log(dataFaculties);
                            for (var i = 0; i < dataFaculties.length; i++) {
                                $('#dropdownFaculty').append('<option value="' + dataFaculties[i].facId + '">' + dataFaculties[i].facName + '</option>');
                            }
                        }
                    }
                },
                error: function (jqXHR, status) {
                    console.log(jqXHR);
                }
            });
        }

        $("#dropdownUniversity").change(function () {
            $('#dropdownFaculty').empty();
            var uniId = this.value;
            var university = dataUniversities.filter(function (el) {
                return el.uniId == uniId;
            });
            if (university.length > 0) {
                dataFaculties = university[0].faculties;
                for (var i = 0; i < dataFaculties.length; i++) {
                    $('#dropdownFaculty').append('<option value="' + dataFaculties[i].facId + '">' + dataFaculties[i].facName + '</option>');
                }
            }
        });


        /*----------- PAGE 2 -------------*/
        _isInitGmapStartAndEndPlace = false;
        _googleMapType = 1;
        var subjectDetailForApplyJobViews = [];
        var applySubjects = [];
        var applyDays = [];
        var marker = null;
        //exp
        var dataExp = [{
            name: "ไม่มีประสบการณ์สอน", val: "0"
        }, {
            name: "1 ปี", val: "1"
        }, {
            name: "2 ปี", val: "2"
        }, {
            name: "3 ปี", val: "3"
        }, {
            name: "4 ปี", val: "4"
        }, {
            name: "5 ปีขึ้นไป", val: "5"
        }];
        for (var i = 0; i < dataExp.length; i++) {
            $('#dropdownExp').append('<option value="' + dataExp[i].val + '">' + dataExp[i].name + '</option>');
        }


        for (var i = 0; i < dataTime.length; i++) {
            $('#dropdownJobDetailStartTime').append('<option value="' + dataTime[i].val + '">' + dataTime[i].name + '</option>');
            $('#dropdownJobDetailEndTime').append('<option value="' + dataTime[i].val + '">' + dataTime[i].name + '</option>');
        }

        $(document).ready(function () {
            getSubjectForApplyJob();
            //  onloadtable();
            $('#btnAddClass').click(function () {
                addApplyJobList();
            });
            $('#btnAddJobDetail').click(function () {
                addApplyDayList();
            });
        });

        function initialData() {
            console.log('initial data');
            $.ajax({
                type: "GET",
                url: _gServiceURL + "tutor/getworkdetail/" + _gUser.turId,
                contentType: "application/json; charset=utf-8",
                crossDomain: true,
                dataType: "json",
                success: function (data, status, jqXHR) {
                    var tutorView = data.data.tutorView;
                    console.log(tutorView);
                    var messages = data.message;
                    var alert;
                    if (tutorView != null) {
                        if (tutorView.englishFlag == 'Y') {
                            $('#chkEnglishFlag').prop('checked', true);
                        }
                        if (tutorView.interFlag == 'Y') {
                            $('#chkInterFlag').prop('checked', true);
                        }
                        console.log('tutorView.maxClsPerDay');
                        console.log(tutorView.maxClsPerDay);
                        $('#optMaxWorkPerDay').val(tutorView.maxClsPerDay);
                        $('#optMaxWork').val(tutorView.maxCls);
                        applySubjects = tutorView.subjectDetailViews;
                        applyDays = tutorView.tutorAvailableTimeloacations;
                        for (var i = 0; i < applySubjects.length; i++) {
                            console.log("data : " + applySubjects[i]);
                            appendApplySubjectList(applySubjects[i], i);
                        }
                        for (var j = 0; j < applyDays.length; j++) {
                            console.log("data : " + applyDays[j]);
                            appendApplyDayList(applyDays[j], j);
                        }
                    }

                },
                error: function (jqXHR, status) {
                    console.log(jqXHR);
                    alert('fail' + status.code);
                }
            });
        }

        //grid Class
        var gridClass = $("#gridClass").bootgrid({
            navigation: 0,
            labels: {
                noResults: 'ไม่พบรายการ'
            }
        }).on("loaded.rs.jquery.bootgrid", function () {
            gridClass.find(".command-edit").on("click", function (e) {
                var i = parseInt($(this).data("row-id"));
                editApplyJobList(i);
            }).end().find(".command-delete").on("click", function (e) {
                var i = parseInt($(this).data("row-id"));
                var result = confirm("ต้องการลบรายการ " + applySubjects[i].subject.subjName + " " + applySubjects[i].subjectCatagory.subcName + " ใช่หรือไม่?");
                if (result) {
                    applySubjects.splice(i, 1);
                    refreshGridClassSubjectList();
                }

            });
        });


        //grid Job Detail
        var gridDetail = $("#gridJobDetail").bootgrid({
            navigation: 0,
            labels: {
                noResults: 'ไม่พบรายการ'
            }
        }).on("loaded.rs.jquery.bootgrid", function () {
            gridDetail.find(".command-edit").on("click", function (e) {
                var i = $(this).data("row-id");
                editApplyDayList(i);
            }).end().find(".command-delete").on("click", function (e) {
                var i = $(this).data("row-id");
                var dayName = dataDay[applyDays[i].tavDayId - 1].name;
                var result = confirm("ต้องการลบรายการ " + dayName + " ใช่หรือไม่?");
                if (result) {
                    applyDays.splice(i, 1);
                    refreshGridDetailDayList();
                }
            });
        });

        function refreshGridClassSubjectList() {
            gridClass.bootgrid('clear');
            for (var j = 0; j < applySubjects.length; j++) {
                console.log("data : " + applySubjects[j]);
                appendApplySubjectList(applySubjects[j], j);
            }
        }

        function refreshGridDetailDayList() {
            gridDetail.bootgrid('clear');
            for (var j = 0; j < applyDays.length; j++) {
                console.log("data : " + applyDays[j]);
                appendApplyDayList(applyDays[j], j);
            }
        }

        function appendApplySubjectList(applySubject, i) {
            console.log(applySubject);
            var exps = dataExp.filter(function (el) {
                return el.val == applySubject.exp;
            });
            var exp = 0;
            if (exps[0]) {
                exp = exps[0];
            }
            gridClass.bootgrid("append", [
                {
                    "id": i + 1,
                    "class": applySubject.subject.subjName,
                    "level": applySubject.subjectCatagory.subcName,
                    "exp": exp.name,
                    "action": "<button id='editBtn' type='button' class='btn btn-xs btn-default command-edit' data-row-id='" + i + "'><div class='fa-pencil'></div></button> "
                        + "<button id='deleteBtn' type='button' class='btn btn-xs btn-default command-delete' data-row-id='" + i + "'><div class='fa-trash-o'></div></button>"
                }
            ]);
        }
        function appendApplyDayList(applyDay, i) {
            console.log(applyDay);
            var dayId = applyDay.tavDayId;
            var divSignActive = "<div class='signActive'></div>";
            var divSignInactive = "<div class='signInActive'></div>";
            if (applyDay.tavTraDrive == 'Y') {
                chkCar = divSignActive;
            } else {
                chkCar = divSignInactive;
            }
            if (applyDay.tavTraBus == 'Y') {
                chkBus = divSignActive;
            } else {
                chkBus = divSignInactive;
            }
            if (applyDay.tavTraTrain == 'Y') {
                chkBTS = divSignActive;
            } else {
                chkBTS = divSignInactive;
            }
            if (applyDay.tavTraTaxi == 'Y') {
                chkTaxi = divSignActive;
            } else {
                chkTaxi = divSignInactive;
            }
            var startTimes = dataTime.filter(function (el) {
                return el.val == applyDay.tavStartTime;
            });
            var startTime = "";
            if (startTimes[0]) {
                startTime = startTimes[0];
            }
            var endTimes = dataTime.filter(function (el) {
                return el.val == applyDay.tavEndTime;
            });
            var endTime = "";
            if (endTimes[0]) {
                endTime = endTimes[0];
            }
            var actionTag = "";
            if (time.tavNumcls > 0) {
                actionTag = "<button id='editBtn' type='button' disable class='btn btn-xs btn-default command-edit' data-row-id='" + i + "'><div class='fa-pencil'></div></button> "
                    + "<button id='deleteBtn' type='button' disable class='btn btn-xs btn-default command-delete' data-row-id='" + i + "'><div class='fa-trash-o'></div></button>";

            } else {
                actionTag = "<button id='editBtn' type='button' class='btn btn-xs btn-default command-edit' data-row-id='" + i + "'><div class='fa-pencil'></div></button> "
                    + "<button id='deleteBtn' type='button' class='btn btn-xs btn-default command-delete' data-row-id='" + i + "'><div class='fa-trash-o'></div></button>";
            }


            gridDetail.bootgrid("append", [
                {
                    "id": i + 1,
                    "day": dataDay[applyDay.tavDayId - 1].name,
                    "StartTime": startTime.name,
                    "endTime": endTime.name,
                    "startPlace": applyDay.tavStartLocation,
                    "endPlace": applyDay.tavEndLocation,
                    "car": chkCar,
                    "bus": chkBus,
                    "bts": chkBTS,
                    "taxi": chkTaxi,
                    "action": actionTag

                }
            ]);
        }

        function addApplyJobList() {
            $('#btnSaveAddClass').val(-1);
            $('#modalAddClass').find('#modalAddClassLabel').text('เพิ่มวิชา');
            $('#modalAddClass').find('#dropdownSubject').prop('disabled', false);
            $('#modalAddClass').find('#dropdownSubject').val($("#dropdownSubject option:first").val());
            $('#modalAddClass').find('#dropdownClass').val($("#dropdownClass option:first").val());
            $('#modalAddClass').find('#dropdownExp').val($("#dropdownExp option:first").val());
        }

        function addApplyDayList() {
            assignDropDownValueDayAdd();
            $('#btnSaveAddDetail').val(-1);
            $('#modalAddJobDetail').find('#modalAddJobDetailLabel').text('เพิ่มวัน เวลา สถานที่และพาหนะที่ใช้เดินทาง');
            $('#modalAddJobDetail').find('#dropdownJobDetailDay').prop('disabled', false);
            $('#modalAddJobDetail').find('#dropdownJobDetailStartTime').val($("#dropdownJobDetailStartTime option:first").val());
            $('#modalAddJobDetail').find('#dropdownJobDetailEndTime').val($("#dropdownJobDetailEndTime option:first").val());
            $('#modalAddJobDetail').find('#txtStartPlace').val('');
            $('#modalAddJobDetail').find('#txtEndPlace').val('');
            $('#chkJobDetailCar').prop('checked', false);
            $('#chkJobDetailBus').prop('checked', false);
            $('#chkJobDetailBTS').prop('checked', false);
            $('#chkJobDetailTaxi').prop('checked', false);
            $('#modalAddJobDetail').find('#groupCopyFromDay').show();
        }

        function editApplyJobList(i) {
            $('#btnSaveAddClass').val(i);
            $('#modalAddClass').find('#modalAddClassLabel').text('แก้ไขวิชา');
            $('#modalAddClass').find('#dropdownSubject').prop('disabled', true);
            $('#modalAddClass').find('#dropdownSubject').val(applySubjects[i].subject.subjId);
            $('#modalAddClass').find('#dropdownClass').val(applySubjects[i].subjectCatagory.subcId);
            $('#modalAddClass').find('#dropdownExp').val(applySubjects[i].exp);
            $('#modalAddClass').modal('show');
        }

        function editApplyDayList(i) {
            assignDropDownValueDayEdit();
            $('#btnSaveAddDetail').val(i);
            var startLocation = new google.maps.LatLng(applyDays[i].tavStartLat, applyDays[i].tavStartLong);
            var endLocation = new google.maps.LatLng(applyDays[i].tavEndLat, applyDays[i].tavEndLong);
            $('#modalAddJobDetail').find('#modalAddJobDetailLabel').text('แก้ไขวัน เวลา สถานที่และพาหนะที่ใช้เดินทาง');
            $('#modalAddJobDetail').find('#dropdownJobDetailDay').val(applyDays[i].tavDayId);
            $('#modalAddJobDetail').find('#dropdownJobDetailDay').prop('disabled', true);
            $('#modalAddJobDetail').find('#dropdownJobDetailStartTime').val(applyDays[i].tavStartTime);
            $('#modalAddJobDetail').find('#dropdownJobDetailEndTime').val(applyDays[i].tavEndTime);
            $('#modalAddJobDetail').find('#txtStartPlace').val(applyDays[i].tavStartLocation);
            $('#modalAddJobDetail').find('#txtEndPlace').val(applyDays[i].tavEndLocation);
            $('#modalAddJobDetail').find('#btnStartGoogleMap').val(startLocation);
            $('#modalAddJobDetail').find('#btnEndGoogleMap').val(endLocation);

            if (applyDays[i].tavTraDrive == 'Y') {
                $('#chkJobDetailCar').prop('checked', true);
            } else {
                $('#chkJobDetailCar').prop('checked', false);
            }
            if (applyDays[i].tavTraBus == 'Y') {
                $('#chkJobDetailBus').prop('checked', true);
            } else {
                $('#chkJobDetailBus').prop('checked', false);
            }
            if (applyDays[i].tavTraTrain == 'Y') {
                $('#chkJobDetailBTS').prop('checked', true);
            } else {
                $('#chkJobDetailBTS').prop('checked', false);
            }
            if (applyDays[i].tavTraTaxi == 'Y') {
                $('#chkJobDetailTaxi').prop('checked', true);
            } else {
                $('#chkJobDetailTaxi').prop('checked', false);
            }
            $('#modalAddJobDetail').find('#groupCopyFromDay').hide();
            $('#modalAddJobDetail').modal('show');
        }

        function assignDropDownValueDayAdd() {
            $('#dropdownCopyFromDay').empty();
            $('#dropdownJobDetailDay').empty();
            for (var i = 0; i < dataDay.length; i++) {
                var days = applyDays.filter(function (el) {
                    return el.tavDayId == dataDay[i].val;
                });
                if (days.length > 0) {
                    $('#dropdownCopyFromDay').append('<option value="' + dataDay[i].val + '">' + dataDay[i].name + '</option>');
                } else {
                    $('#dropdownJobDetailDay').append('<option value="' + dataDay[i].val + '">' + dataDay[i].name + '</option>');
                }
            }
        }

        function assignDropDownValueDayEdit() {
            $('#dropdownCopyFromDay').empty();
            $('#dropdownJobDetailDay').empty();
            for (var i = 0; i < dataDay.length; i++) {
                $('#dropdownCopyFromDay').append('<option value="' + dataDay[i].val + '">' + dataDay[i].name + '</option>');
                $('#dropdownJobDetailDay').append('<option value="' + dataDay[i].val + '">' + dataDay[i].name + '</option>');
            }
        }

        $("#dropdownCopyFromDay").change(function () {
            var coppiedDay = $(this).val();
            var days = applyDays.filter(function (el) {
                return el.tavDayId == coppiedDay;
            });
            if (days) {
                var applyDay = days[0];
                var startLocation = new google.maps.LatLng(applyDay.tavStartLat, applyDay.tavStartLong);
                var endLocation = new google.maps.LatLng(applyDay.tavEndLat, applyDay.tavEndLong);
                $('#modalAddJobDetail').find('#dropdownJobDetailStartTime').val(applyDay.tavStartTime);
                $('#modalAddJobDetail').find('#dropdownJobDetailEndTime').val(applyDay.tavEndTime);
                $('#modalAddJobDetail').find('#txtStartPlace').val(applyDay.tavStartLocation);
                $('#modalAddJobDetail').find('#txtEndPlace').val(applyDay.tavEndLocation);
                $('#modalAddJobDetail').find('#btnStartGoogleMap').val(startLocation);
                $('#modalAddJobDetail').find('#btnEndGoogleMap').val(endLocation);
                if (applyDay.tavTraDrive == 'Y') {
                    $('#chkJobDetailCar').prop('checked', true);
                } else {
                    $('#chkJobDetailCar').prop('checked', false);
                }
                if (applyDay.tavTraBus == 'Y') {
                    $('#chkJobDetailBus').prop('checked', true);
                } else {
                    $('#chkJobDetailBus').prop('checked', false);
                }
                if (applyDay.tavTraTrain == 'Y') {
                    $('#chkJobDetailBTS').prop('checked', true);
                } else {
                    $('#chkJobDetailBTS').prop('checked', false);
                }
                if (applyDay.tavTraTaxi == 'Y') {
                    $('#chkJobDetailTaxi').prop('checked', true);
                } else {
                    $('#chkJobDetailTaxi').prop('checked', false);
                }
            }

        });

        $("#btnSaveAddClass").on("click", function (e) {
            var index = $(this).val();
            var selectedSubjectVal = $("#dropdownSubject option:selected").val();
            var selectedClassVal = $("#dropdownClass option:selected").val();
            var selectedExpVal = $("#dropdownExp option:selected").val();
            var selectedSubjectText = $("#dropdownSubject option:selected").text();
            var selectedClassText = $("#dropdownClass option:selected").text();
            var selectedExpText = $("#dropdownExp option:selected").text();
            var duplicatedApplySubjects = applySubjects.filter(function (el) {
                return el.subject.subjId == selectedSubjectVal && el.subjectCatagory.subcId == selectedClassVal;
            });
            if (duplicatedApplySubjects.length > 0 && index == -1) {
                alert("พบรายการวิชา " + selectedSubjectText + " กลุ่มวิชา" + selectedClassText + " อยู่ในรายการแล้ว");
            } else {
                if (selectedSubjectText && selectedClassText && selectedExpText) {

                    if (index == -1) {
                        var newSubject = {
                            subject: {
                                subjId: parseInt(selectedSubjectVal),
                                subjName: selectedSubjectText
                            },
                            subjectCatagory: {
                                subcId: parseInt(selectedClassVal),
                                subcName: selectedClassText
                            },
                            exp: parseInt(selectedExpVal)
                        };
                        console.log(newSubject);
                        applySubjects.push(newSubject);
                    } else {
                        var updateSubject = applySubjects[index];
                        updateSubject.subject.subjId = parseInt(selectedSubjectVal);
                        updateSubject.subject.subjName = selectedSubjectText;
                        updateSubject.subjectCatagory.subcId = parseInt(selectedClassVal);
                        updateSubject.subjectCatagory.subcName = selectedClassText;
                        updateSubject.exp = parseInt(selectedExpVal);
                        applySubjects[index] = updateSubject;
                    }
                    refreshGridClassSubjectList();
                    $('#modalAddClass').modal('hide');
                }
            }
        });


        $("#btnSaveAddDetail").on("click", function (e) {
            var selectedJobDetailDay = $("#dropdownJobDetailDay option:selected").val();
            var selectedJobDetailStartTime = $("#dropdownJobDetailStartTime option:selected").val();
            var selectedJobDetailEndTime = $("#dropdownJobDetailEndTime option:selected").val();
            var txtStartPlace = $("#txtStartPlace").val();
            var txtEndPlace = $("#txtEndPlace").val();
            var startLocation = $('#btnStartGoogleMap').val();
            var endLocation = $('#btnEndGoogleMap').val();
            startLocation = startLocation.replace('(', '');
            startLocation = startLocation.replace(')', '');
            var startloc = startLocation.split(",");
            endLocation = endLocation.replace('(', '');
            endLocation = endLocation.replace(')', '');
            var endloc = endLocation.split(",");
            var chkCar = "";
            var chkBus = "";
            var chkBTS = "";
            var chkTaxi = "";
            var active = "Y";
            var inactive = "N";
            if ($("#chkJobDetailCar").is(':checked')) {
                chkCar = active;
            } else {
                chkCar = inactive;
            }
            if ($("#chkJobDetailBus").is(':checked')) {
                chkBus = active;
            } else {
                chkBus = inactive;
            }
            if ($("#chkJobDetailBTS").is(':checked')) {
                chkBTS = active;
            } else {
                chkBTS = inactive;
            }
            if ($("#chkJobDetailTaxi").is(':checked')) {
                chkTaxi = active;
            } else {
                chkTaxi = inactive;
            }
            var index = $(this).val();
            if (index == -1) {
                var newDay = {
                    tavDayId: parseInt(selectedJobDetailDay),
                    tavStartLat: parseFloat(startloc[0]),
                    tavStartLong: parseFloat(startloc[1]),
                    tavEndLat: parseFloat(endloc[0]),
                    tavEndLong: parseFloat(endloc[1]),
                    tavStartLocation: txtStartPlace,
                    tavEndLocation: txtEndPlace,
                    tavStartTime: selectedJobDetailStartTime,
                    tavEndTime: selectedJobDetailEndTime,
                    tavTraDrive: chkCar,
                    tavTraBus: chkBus,
                    tavTraTrain: chkBTS,
                    tavTraTaxi: chkTaxi,
                    tavNumcls: parseInt(0)
                };
                applyDays.push(newDay);
            } else {
                var updateDay = applyDays[index];
                updateDay.tavStartLat = parseFloat(startloc[0]);
                updateDay.tavStartLong = parseFloat(startloc[1]);
                updateDay.tavEndLat = parseFloat(endloc[0]);
                updateDay.tavEndLong = parseFloat(endloc[1]);
                updateDay.tavStartLocation = txtStartPlace;
                updateDay.tavEndLocation = txtEndPlace;
                updateDay.tavStartTime = selectedJobDetailStartTime;
                updateDay.tavEndTime = selectedJobDetailEndTime;
                updateDay.tavTraDrive = chkCar;
                updateDay.tavTraBus = chkBus;
                updateDay.tavTraTrain = chkBTS;
                updateDay.tavTraTaxi = chkTaxi;
                applyDays[index] = updateDay;
            }
            refreshGridDetailDayList();
            $('#modalAddJobDetail').modal('hide');

        });

        // load subject list
        $("#dropdownSubject").change(function () {
            $('#dropdownClass').empty();
            var subjId = this.value;
            var subjectDetailForApplyJobViewsBySubjid = subjectDetailForApplyJobViews.filter(function (el) {
                return el.subjId == subjId;
            });
            console.log(subjectDetailForApplyJobViewsBySubjid);

            if (subjectDetailForApplyJobViewsBySubjid[0]) {
                var subjectCatagories = subjectDetailForApplyJobViewsBySubjid[0].subjectCatagories;
                console.log(subjectCatagories);
                for (var i = 0; i < subjectCatagories.length; i++) {
                    $('#dropdownClass').append('<option value="' + subjectCatagories[i].subcId + '">' + subjectCatagories[i].subcName + '</option>');
                }
            }

        });
        function getSubjectForApplyJob() {
            subjectDetailForApplyJobViews = [];
            console.log("initial data for subject list");
            $.ajax({
                type: "GET",
                url: _gServiceURL + "subjectdetail/listforapplyjob",
                contentType: "application/json; charset=utf-8",
                crossDomain: true,
                dataType: "json",
                success: function (data, status, jqXHR) {
                    console.log(data.data.subjectDetailForApplyJobViews);
                    var messages = data.message;
                    var alert;
                    if (data.status == 200) {
                        subjectDetailForApplyJobViews = data.data.subjectDetailForApplyJobViews;
                        for (var i = 0; i < subjectDetailForApplyJobViews.length; i++) {
                            $('#dropdownSubject').append('<option value="' + subjectDetailForApplyJobViews[i].subject.subjId + '">' + subjectDetailForApplyJobViews[i].subject.subjName + '</option>');
                        }
                        if (subjectDetailForApplyJobViews[0]) {
                            var subjectCatagories = subjectDetailForApplyJobViews[0].subjectCatagories;
                            console.log(subjectCatagories);
                            for (var i = 0; i < subjectCatagories.length; i++) {
                                $('#dropdownClass').append('<option value="' + subjectCatagories[i].subcId + '">' + subjectCatagories[i].subcName + '</option>');
                            }
                        }
                        //          initialData();
                    }
                },
                error: function (jqXHR, status) {
                    console.log(jqXHR);
                    alert('fail' + status.code);
                }
            });
        }
        // Google map
        $("#btnStartGoogleMap").on("click", function (e) {
            //   console.log("Open Map start "+startLocation);
            _googleMapType = 1;
            if ($('#modalAddJobDetail').find('#txtStartPlace')) {
                var address = $('#modalAddJobDetail').find('#txtStartPlace').val();
                $('#pac-input').val(address);
            } else {
                $('#pac-input').val("");
            }
            if (_isInitGmapStartAndEndPlace == false) {
                _isInitGmapStartAndEndPlace = true;
                initMap();
            }
            var startLocation = $(this).val();
            if (startLocation) {
                startLocation = startLocation.replace('(', '');
                startLocation = startLocation.replace(')', '');
                var loc = startLocation.split(",");
                var lat = parseFloat(loc[0]);
                var lng = parseFloat(loc[1]);
                var latLog = new google.maps.LatLng(lat, lng);
                marker.setPosition(latLog);
                var map = marker.map;
                map.setCenter(latLog);
            }
        });
        $("#btnEndGoogleMap").on("click", function (e) {
            //console.log("Open Map end");
            _googleMapType = 2;
            if ($('#modalAddJobDetail').find('#txtEndPlace')) {
                var address = $('#modalAddJobDetail').find('#txtEndPlace').val();
                $('#pac-input').val(address);
            } else {
                $('#pac-input').val("");
            }
            if (_isInitGmapStartAndEndPlace == false) {
                _isInitGmapStartAndEndPlace = true;
                initMap();
            }
            var endLocation = $(this).val();
            if (endLocation) {
                endLocation = endLocation.replace('(', '');
                endLocation = endLocation.replace(')', '');
                var loc = endLocation.split(",");
                var lat = parseFloat(loc[0]);
                var lng = parseFloat(loc[1]);
                var latLog = new google.maps.LatLng(lat, lng);
                marker.setPosition(latLog);
                var map = marker.map;
                map.setCenter(latLog);
            }
        });

        function initMap() {
            console.log("INIT MAP");
            var geocoder = new google.maps.Geocoder;
            var latLog = new google.maps.LatLng(13.736334, 100.531102);
            var map = new google.maps.Map(document.getElementById('map'), {
                center: latLog,
                zoom: 15,
                disableDefaultUI: true
            });
            // Set marker
            marker = new google.maps.Marker({
                map: map,
                position: latLog
            });
            google.maps.event.addListener(map, 'click', function (event) {
                setPlaceMarker(event.latLng, geocoder);
            });

            // Search box and auto complete
            var input = document.getElementById('pac-input');
            var options = {
                types: ['establishment']
            };
            var autocomplete = new google.maps.places.Autocomplete(input);
            autocomplete.bindTo('bounds', map);
            map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

            autocomplete.addListener('place_changed', function () {
                console.log("Place Changed");
                var place = autocomplete.getPlace();
                placeChangedByAutoComplete(autocomplete.getPlace(), map, geocoder);
            });

        }

        function setPlaceMarker(location, geocoder) {
            marker.setPosition(location);
            console.log(location);
            findAddressFromLocation(location, geocoder);
        }

        function placeChangedByAutoComplete(place, map, geocoder) {
            console.log(place);
            console.log(place.place_id);
            if (!place.place_id) {
                return;
            }
            geocoder.geocode({ 'placeId': place.place_id }, function (results, status) {
                if (status !== 'OK') {
                    window.alert('Geocoder failed due to: ' + status);
                    return;
                }
                console.log(place.place_id);
                map.setZoom(15);
                map.setCenter(results[0].geometry.location);
                // Set the position of the marker using the place ID and location.
                marker.setPlace({
                    placeId: place.place_id,
                    location: results[0].geometry.location
                });
                var address = $('#pac-input').val();
                console.log("_googleMapType :" + _googleMapType);
                if (_googleMapType == 1) {
                    $('#btnStartGoogleMap').val(results[0].geometry.location);
                    $('#modalAddJobDetail').find('#txtStartPlace').val(address);
                } else {
                    $('#btnEndGoogleMap').val(results[0].geometry.location);
                    $('#modalAddJobDetail').find('#txtEndPlace').val(address);
                }

                $('#modalGoogleMap').modal('hide');

            });
        }

        function findAddressFromLocation(latLng, geocoder) {
            geocoder.geocode({ 'latLng': latLng }, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    console.log(results[0]);
                    var address = results[0].formatted_address;
                    $('#pac-input').val(address);
                    if (_googleMapType == 1) {
                        $('#btnStartGoogleMap').val(latLng);
                        $('#modalAddJobDetail').find('#txtStartPlace').val(address);
                    } else {
                        $('#btnEndGoogleMap').val(latLng);
                        $('#modalAddJobDetail').find('#txtEndPlace').val(address);
                    }

                    $('#modalGoogleMap').modal('hide');

                    //   $('#address').html('Address:' + results[0].formatted_address);
                }
                else {
                    //    $('#address').html('Geocoding failed: ' + status);
                    console.log("Geocoding failed: " + status);
                }
            });
        }

        function findLocationFromAddress() {

        }

        function geocodeAddress(geocoder, resultsMap) {
            var address = document.getElementById('address').value;
            geocoder.geocode({ 'address': address }, function (results, status) {
                if (status === 'OK') {
                    resultsMap.setCenter(results[0].geometry.location);

                    var marker = new google.maps.Marker({
                        map: resultsMap,
                        position: results[0].geometry.location
                    });
                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        }
        function geocodePlaceId(geocoder, map, placeId) {
            geocoder.geocode({ 'placeId': placeId }, function (results, status) {
                if (status === 'OK') {
                    console.log('PLACE');
                    if (results[0]) {
                        console.log(results[0]);
                    } else {
                        window.alert('No results found');
                    }
                } else {
                    window.alert('Geocoder failed due to: ' + status);
                }
            });
        }

        // update job
        $("#btnAddTutor").on("click", function (e) {
            var txtEmail = $('#txtEmail').val();
            var txtPassword = $('#txtNewPassword').val();
            var txtConfirmPassword = $('#txtConfirmPassword').val();
            var txtFirstName = $('#txtFirstName').val();
            var txtLastName = $('#txtLastName').val();
            var txtNickname = $('#txtNickname').val();
            var txtTel = $('#txtTel').val();
            var txtAddress = $('#txtAddress').val();
            var pickerBirthdate = $('#pickerBirthdate').val();
            var sex = $('#dropdownSex option:selected').val();
            var uniId = parseInt($('#dropdownUniversity option:selected').val());
            var facId = parseInt($('#dropdownFaculty option:selected').val());
            var turClip = $('#txtClip').val();
            var inputIDCardFile = $('#inputIDCardFile').val();
            if (_gFBUser.email) {
               if (!txtEmail || !txtFirstName || !txtLastName || !txtTel || !sex
                    || !uniId || !facId) {
                    $(".alert-danger").find("strong").text('โปรดระบุข้อมูลให้ครบถ้วน');
                    $(".alert-danger").show();
                    $('html, body').animate({ scrollTop: $('.breadcrumb').offset().top }, 'fast');
                }
                else {

                    var tutorView = {
                        turEmail: txtEmail,
                        turNickname: txtNickname,
                        turAddress: txtAddress,
                        turBirthdate: pickerBirthdate,
                        turClip: turClip,
                        turFile: inputIDCardFile,
                        turSex: sex,
                        turUniId: uniId,
                        turFacId: facId,
                        turTel: txtTel
                    }
                }
                console.log(tutorView);
                applyJob(tutorView);
            } else {
                if (txtPassword != txtConfirmPassword) {
                    $(".alert-danger").find("strong").text('รหัสผ่านไม่ถูกต้อง');
                    $(".alert-danger").show();
                    $('html, body').animate({ scrollTop: $('.breadcrumb').offset().top }, 'fast');
                } else if (!txtEmail || !txtPassword || !txtFirstName || !txtLastName || !txtTel || !sex
                    || !uniId || !facId) {
                    $(".alert-danger").find("strong").text('โปรดระบุข้อมูลให้ครบถ้วน');
                    $(".alert-danger").show();
                    $('html, body').animate({ scrollTop: $('.breadcrumb').offset().top }, 'fast');
                }
                else {

                    var tutorView = {
                        turEmail: txtEmail,
                        turPassword: txtPassword,
                        turFirstname: txtFirstName,
                        turLastname: txtLastName,
                        turNickname: txtNickname,
                        turAddress: txtAddress,
                        turBirthdate: pickerBirthdate,
                        turClip: turClip,
                        turFile: inputIDCardFile,
                        turSex: sex,
                        turUniId: uniId,
                        turFacId: facId,
                        turTel: txtTel
                    }
                }
                console.log(tutorView);
                applyJob(tutorView);
            }

        });

        function applyJob(tutorView) {

            $.ajax({
                type: "POST",
                url: _gServiceURL + "tutor/register",
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(tutorView),
                crossDomain: true,
                dataType: "json",
                success: function (data, status, jqXHR) {
                    console.log(data.data);
                    _gHasTutorTime = data.data.hasTutorTime;
                    var msg = data.data.message;
                    _gUser.turId = data.data.turId;
                    _gUser.turName = data.data.turName;
                    _gUserType = "tutor";

                    jQuery("#divShowUser").html(_gUser.turName);
                    $(".alert-danger").hide();
                    $(".alert-success").show();
                    $(".alert-success").find("strong").text(msg);
                    $('html, body').animate({ scrollTop: $('.breadcrumb').offset().top }, 'fast');
                    loadMainPage();
                },
                error: function (jqXHR, status) {
                    $(".alert-success").hide();
                    $(".alert-danger").show();
                    $(".alert-danger").find("strong").text(msg);
                    $('html, body').animate({ scrollTop: $('.breadcrumb').offset().top }, 'fast');
                }

            });

        }

    </script>
</body>

</html>