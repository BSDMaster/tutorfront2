<!DOCTYPE html>
<html>

<head>

</head>

<body>
    <div>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="javascript:loadMainPage();">หน้าหลัก</a>
            </li>
            <li class="breadcrumb-item active" id="breadcrumbstuclass">งานสอนเลขที่ </li>
        </ol>
    </div>
    <br>
    <div class="alert alert-dismissible alert-success" style="display: none;">
        <button type="button" class="close" data-dismiss="alert"></button>
        <strong>บันทึกข้อมูลสำเร็จ</strong>
    </div>
    <div class="alert alert-dismissible alert-danger" style="display: none;">
        <button type="button" class="close" data-dismiss="alert"></button>
        <strong>ไม่สามารถบันทึกข้อมูลได้</strong>
    </div>
    <div class="right">
        <div class="btn-group" id="btnCreateRequest" role="group" aria-label="Button group with nested dropdown">
            <button type="button" class="btn btn-primary btn-lg">ยื่นคำร้อง</button>
            <div class="btn-group show" role="group">
                <button id="btnGroupDrop1" type="button" class="btn btn-primary dropdown-toggle btn-lg" data-toggle="dropdown" aria-haspopup="true"
                    aria-expanded="true"></button>
                <div class="dropdown-menu" aria-labelledby="btnGroupDrop1" x-placement="bottom-start" style="position: absolute; transform: translate3d(0px, 38px, 0px); top: 0px; left: 0px; will-change: transform;">

                    <a class="dropdown-item" href="javascript:toggleModalCancelClsByStudent()">ยกเลิกการลงทะเบียนเรียน</a>
                    <a class="dropdown-item" href="javascript:toggleModalChangeTutor()" id="aListRequestChangeTutor">ขอเปลี่ยนติวเตอร์</a>
                </div>
            </div>
        </div>
        <button type="button" class="btn btn-success btn-lg" id="btnCancelClassBtStudent" onClick="javascript:toggleModalCancelClsByStudent();">ยกเลิกการลงทะเบียนเรียน</button>&nbsp;&nbsp;
        <button type="button" class="btn btn-success btn-lg" id="btnEvaluateTutor">ประเมินติวเตอร์</button>&nbsp;&nbsp;
    </div>
    <div class="label-header" id="headerstuclass">งานสอน</div>
    <div style="margin-top:30px;">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <form class="form-horizontal">
                        <div class="form-group">
                            <label class="col-lg-3">รหัสงานสอน :</label>
                            <label class="col-lg-9 labelnormal" id="lblStuClsClsId">คณิตศาสตร์</label>
                        </div>
                        <div class="form-group">
                            <label class="col-lg-3">วิชา :</label>
                            <label class="col-lg-9 labelnormal" id="lblStuClsSubjectCat">คณิตศาสตร์</label>
                        </div>
                        <div class="form-group">
                            <label class="col-lg-3">ภาษาที่ใช้สอน :</label>
                            <label class="col-lg-9 labelnormal" id="lblStuClsProgram">ปกติ</label>
                        </div>
                        <div class="form-group">
                            <label class="col-lg-3">ประเภทงานสอน :</label>
                            <label class="col-lg-9 labelnormal" id="lblStuClsSpec">ปกติ</label>
                        </div>
                        <div class="form-group">
                            <label class="col-lg-3">สถานะ :</label>
                            <label class="col-lg-9 labelnormal" id="lblStuClsStatus">คณิตศาสตร์</label>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <br>
    <div class="label-header">ข้อมูลนักเรียน</div>
    <div style="margin-top:30px;">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <form class="form-horizontal">
                        <div class="form-group">
                            <label class="col-lg-3">ชื่อ :</label>
                            <label class="col-lg-9 labelnormal" id="lblStuClsStuName"></label>
                        </div>
                        <div class="form-group">
                            <label class="col-lg-3">เบอร์โทรติดต่อ :</label>
                            <label class="col-lg-9 labelnormal" id="lblStuClsStuTel"></label>
                        </div>
                        <div class="form-group">
                            <label class="col-lg-3">อีเมล์ :</label>
                            <label class="col-lg-9 labelnormal" id="lblStuClsStuEmail"></label>
                        </div>
                        <div class="form-group">
                            <label class="col-lg-3">เพศ :</label>
                            <label class="col-lg-9 labelnormal" id="lblStuClsStuSex">ชาย</label>
                        </div>
                        <div class="form-group">
                            <label class="col-lg-3">ระดับชั้น :</label>
                            <label class="col-lg-9 labelnormal" id="lblStuClsLevel">ประถมศึกษาปีที่ 6</label>
                        </div>
                        <div class="form-group">
                            <label class="col-lg-3">สถานศึกษา :</label>
                            <label class="col-lg-9 labelnormal" id="lblStuClsSchool">โรงเรียน</label>
                        </div>
                        <div class="form-group">
                            <label class="col-lg-3">จำนวนนักเรียน :</label>
                            <label class="col-lg-9 labelnormal" id="lblStuClsNumOfStudent">1</label>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <br>
    <div style="display: none;" id="tutorSection">
        <div class="label-header">ข้อมูลติวเตอร์</div>
        <div style="margin-top:30px;">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12">
                        <form class="form-horizontal">
                            <div class="form-group">
                                <label class="col-lg-3">ชื่อ :</label>
                                <label class="col-lg-9 labelnormal" id="lblStuClsTurName"></label>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-3">เบอร์โทรติดต่อ :</label>
                                <label class="col-lg-9 labelnormal" id="lblStuClsTurTel"></label>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-3">อีเมล์ :</label>
                                <label class="col-lg-9 labelnormal" id="lblStuClsTurEmail"></label>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-3">เพศ :</label>
                                <label class="col-lg-9 labelnormal" id="lblStuClsTurSex">ชาย</label>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-3">คณะ :</label>
                                <label class="col-lg-9 labelnormal" id="lblStuClsTurFac"></label>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-3">สถาบัน :</label>
                                <label class="col-lg-9 labelnormal" id="lblStuClsTurUni"></label>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br>
    <div class="label-header">ข้อมูลวัน เวลา สถานที่เรียน</div>
    <div style="margin:30px;">
        <table id="gridStuClassTime" class="table table-condensed table-hover table-striped scroll">
            <thead>
                <tr>
                    <th data-column-id="day" data-width="10%">วัน</th>
                    <th data-column-id="time" data-width="30%">เวลา</th>
                    <th data-column-id="location" data-width="60%">สถานที่</th>
                </tr>
            </thead>
        </table>
    </div>
    <br>
    <!-- Modal -->
    <div class="modal fade" id="modalTutorEvaluate" tabindex="-1" role="dialog" aria-labelledby="tutorEvaluateLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="tutorEvaluateLabel">ประเมินติวเตอร์</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>

                </div>
                <div class="modal-body" id="divTutorEvaLabel">
                    กรูณาให้คะแนนติวเตอร์หลังจากที่ท่านเรียนจบแล้ว
                </div>


                <!--Eva Tutor-->
                <section class='rating-widget'>

                    <!-- Rating Stars Box -->
                    <div class='rating-stars text-center'>
                        <ul id='stars'>
                            <li class='star' title='Poor' data-value='1'>
                                <i class='fa fa-star fa-fw'></i>
                            </li>
                            <li class='star' title='Fair' data-value='2'>
                                <i class='fa fa-star fa-fw'></i>
                            </li>
                            <li class='star' title='Good' data-value='3'>
                                <i class='fa fa-star fa-fw'></i>
                            </li>
                            <li class='star' title='Excellent' data-value='4'>
                                <i class='fa fa-star fa-fw'></i>
                            </li>
                            <li class='star' title='WOW!!!' data-value='5'>
                                <i class='fa fa-star fa-fw'></i>
                            </li>
                        </ul>
                    </div>

                    <!--<div class='success-box'>
                        <div class='clearfix'></div>
                        <div class='text-message'></div>
                        <div class='clearfix'></div>
                    </div>-->
                </section>
                <!---->


                <div class="modal-footer">
                    <button type="button" class="btn btn-default btn-lg" data-dismiss="modal">ยกเลิก</button>
                    <button type="button" class="btn btn-primary btn-lg" onClick="javascript:confirmevaluate();">ยืนยันการประเมิน</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Cancel Class Modal -->
    <div class="modal fade" id="modalCancelClsByStudent" tabindex="-1" role="dialog" aria-labelledby="cancelClsByStudentLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="cancelClsByStudentLabel">แจ้งขอยกเลิกการลงทะเบียน</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="divCancelClsByStuLabel">
                        กรุณาระบุสาเหตุที่แจ้งขอยกเลิกลงทะเบียน และจำนวนชั่วโมงที่เรียนไปแล้ว (หากยังไม่ถึงกำหนดเรียนกรุณาเลือกเป็น 0 ชั่วโมง)
                    </div>
                    <div class="form-group">
                        <label for="reasonCancelByStuTextarea">สาเหตุที่ขอยกเลิกการลงทะเบียน</label>
                        <textarea class="form-control" id="reasonCancelByStuTextarea" rows="2"></textarea>
                    </div>
                    <div class="form-group" id="divNumHours">
                        <label for="dropdownCancelByStuHours">จำนวนชั่วโมงที่เรียนไปแล้ว</label>
                        <select class="custom-select" id="dropdownCancelByStuHours">
                            <option selected="" value="0">0</option>
                            <option value="1">1 ชั่วโมง</option>
                            <option value="2">2 ชั่วโมง</option>
                            <option value="3">3 ชั่วโมง</option>
                            <option value="4">4 ชั่วโมง</option>
                            <option value="5">5 ชั่วโมง</option>
                            <option value="6">6 ชั่วโมง</option>
                            <option value="7">7 ชั่วโมง</option>
                            <option value="8">8 ชั่วโมงขึ้นไป</option>
                        </select>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default btn-lg" data-dismiss="modal">ยกเลิก</button>
                    <button type="button" class="btn btn-primary btn-lg" onClick="javascript:cancelclassbystudent();">ยืนยันขอยกเลิกลงทะเบียน</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Change Tutor Modal -->
    <div class="modal fade" id="modalChangeTutor" tabindex="-1" role="dialog" aria-labelledby="changeTutorLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="changeTutorLabel">แจ้งขอยกเลิกการลงทะเบียน</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="divChangeTutorLabel">
                        กรุณาระบุสาเหตุที่ขอเปลี่ยนติวเตอร์ จำนวนชั่วโมงที่เรียนไปแล้ว และกดปุ่ม "ยืนยันขอยกเลิกลงทะเบียน" หากท่านต้องการขอยกเลิกลงทะเบียน
                    </div>
                    <div class="form-group">
                        <label for="reasonChangeTutorTextarea">สาเหตุที่ขอเปลี่ยนติวเตอร์</label>
                        <textarea class="form-control" id="reasonChangeTutorTextarea" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="dropdownChangeTutorHours">จำนวนชั่วโมงที่เรียนไปแล้ว</label>
                        <select class="custom-select" id="dropdownChangeTutorHours">
                            <option selected="" value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                        </select>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default btn-lg" data-dismiss="modal">ยกเลิก</button>
                    <button type="button" class="btn btn-primary btn-lg" onClick="javascript:changetutor();">ยืนยันขอเปลี่ยนติวเตอร์</button>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    var _clsId;
    var _stuTimesClassDetail = [];
    jQuery(document).ready(function () {
        initialStuClassDetailData();

        initialEvaTutor();
    });

    var gridStuClassTime = $("#gridStuClassTime").bootgrid({
        navigation: 0,
        labels: {
            noResults: 'ไม่พบรายการ'
        }
    });

    function initialStuClassDetailData() {

        $.ajax({
            type: "GET",
            url: _gServiceURL + "class/classdetail/student/" + _gSelectedClsId,
            contentType: "application/json; charset=utf-8",
            crossDomain: true,
            dataType: "json",
            success: function (data, status, jqXHR) {

                var classDetail = data.data.classDetailView;
                console.log(classDetail);
                $('#breadcrumbstuclass').text('งานสอนเลขที่ ' + classDetail.clsId);
                $('#headerstuclass').text('งานสอนเลขที่ ' + classDetail.clsId);
                _clsId = classDetail.clsId;
                $('#lblStuClsClsId').text(classDetail.clsId);
                $('#lblStuClsStatus').text(classDetail.statusName);
                $('#lblStuClsSubjectCat').text(classDetail.subjectAndGroupDetailName);
                $('#lblStuClsProgram').text(classDetail.program);
                $('#lblStuClsPrice').text(classDetail.recPrice);
                $('#lblStuClsStuSex').text(classDetail.stuSex);
                $('#lblStuClsLevel').text(classDetail.stuLevel);
                $('#lblStuClsSchool').text(classDetail.stuSchool);
                $('#lblStuClsNumOfStudent').text(classDetail.numOfStu);
                $('#lblStuClsStuName').text(classDetail.stuName);
                $('#lblStuClsStuTel').text(classDetail.stuTel);
                $('#lblStuClsStuEmail').text(classDetail.stuEmail);
                if (classDetail.isSpec == 'Y') {
                    $('#lblStuClsSpec').text('ระบุติวเตอร์');
                    $('#aListRequestChangeTutor').hide();
                } else {
                    $('#lblStuClsSpec').text('ไม่ระบุติวเตอร์');
                    $('#aListRequestChangeTutor').show();
                }
                if (classDetail.statusId == 1 || classDetail.statusId == 5 || classDetail.statusId == 6) {
                    $('#divNumHours').hide();
                    $('#btnCreateRequest').hide();
                    $('#btnCancelClassBtStudent').show();
                    $('#btnEvaluateTutor').hide();
                } else if (classDetail.statusId == 7) {
                    $('#divNumHours').show();
                    $('#btnCreateRequest').show();
                    $('#btnCancelClassBtStudent').hide();
                    $('#btnEvaluateTutor').show();
                } else {
                    $('#divNumHours').hide();
                    $('#btnCreateRequest').hide();
                    $('#btnCancelClassBtStudent').hide();
                    $('#btnEvaluateTutor').hide();
                }

                if ((classDetail.statusId == 2 || classDetail.statusId == 3 || classDetail.statusId == 4
                    || classDetail.statusId == 7 || classDetail.statusId == 8 || classDetail.statusId == 9
                    || (classDetail.statusId == 6 && classDetail.isSpec == 'Y')) && classDetail.turName != null) {
                    $('#lblStuClsTurName').text(classDetail.turName);
                    $('#lblStuClsTurTel').text(classDetail.turTel);
                    $('#lblStuClsTurEmail').text(classDetail.turEmail);
                    $('#lblStuClsTurFac').text(classDetail.turFac);
                    $('#lblStuClsTurUni').text(classDetail.turUni);
                    $('#lblStuClsTurSex').text(classDetail.turSex);
                    $('#tutorSection').show();
                } else {
                    $('#tutorSection').hide();
                }
                _stuTimesClassDetail = classDetail.recommendTimelocationList;
                for (var i = 0; i < _stuTimesClassDetail.length; i++) {
                    appendStuClassTime(_stuTimesClassDetail[i], i);
                }
            },
            error: function (jqXHR, status) {
            }

        });

    }

    function appendStuClassTime(time, i) {
        gridStuClassTime.bootgrid("append", [
            {
                "day": time.day,
                "time": time.time,
                "location": time.location
            }
        ]);
    }
    $("#btnEvaluateTutor").on("click", function (e) {

        console.log("evaluate");
        $("#modalTutorEvaluate").modal('show');
    });
    function openevaluatetutor() {
        console.log("evaluate");
        $("#modalTutorEvaluate").modal('show');
    }

    function confirmevaluate() {
        var ratingValue = parseInt($('#stars li.selected').last().data('value'), 10);
        var requestbody = {
            clsId: _clsId,
            evaluateScore: String(ratingValue)
        }
        console.log(requestbody);
        $("#modalTutorEvaluate").modal('hide');
        $.ajax({
            type: "POST",
            url: _gServiceURL + "class/classcomplete",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(requestbody),
            crossDomain: true,
            dataType: "json",
            success: function (data, status, jqXHR) {
                loadMainPage();
                $(".alert-success").show();
                $('html, body').animate({ scrollTop: $('.breadcrumb').offset().top }, 'fast');
                $('#btnCreateRequest').hide();
                $('#btnCancelClassBtStudent').hide();
                $('#btnEvaluateTutor').hide();
            },
            error: function (jqXHR, status) {
                $(".alert-danger").show();
                $('html, body').animate({ scrollTop: $('.breadcrumb').offset().top }, 'fast');
            }

        });
    }

    function toggleModalCancelClsByStudent() {
        $('#modalCancelClsByStudent').modal('show');
    }

    function toggleModalChangeTutor() {
        $('#modalChangeTutor').modal('show');
    }

    function cancelclassbystudent() {
        console.log("cancelclassbystudent");
        var reason = $('#reasonCancelByStuTextarea').val();
        var hours = $('#dropdownCancelByStuHours option:selected').val();
        if (_gUser.stuId != null && reason && hours) {
            var bodyRequest = {
                clsId: parseInt(_gSelectedClsId),
                requester: _gUser.stuName,
                reason: reason,
                hours: parseInt(hours)
            };
            console.log(bodyRequest);
            $.ajax({
                type: "POST",
                url: _gServiceURL + "classrequest/requesttocancelbystudent/",
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(bodyRequest),
                crossDomain: true,
                dataType: "json",
                success: function (data, status, jqXHR) {
                    var alert;
                    var msg = data.message;
                    if (data.status == 200) {
                        alert = $(".alert-success");
                        $('#btnCreateRequest').hide();
                        $('#btnCancelClassBtStudent').hide();
                        $('#btnEvaluateTutor').hide();
                    } else {
                        alert = $(".alert-danger");
                    }
                    alert.find("strong").text(msg);
                    alert.show();
                },
                error: function (jqXHR, status) {
                    var alert = $(".alert-danger");
                    alert.find("strong").text(jqXHR);
                    alert.show();
                }
            });
        }
        $('#modalCancelClsByStudent').modal('hide');
    }

    function changetutor() {
        console.log("changetutor");
        var reason = $('#reasonChangeTutorTextarea').val();
        var hours = $('#dropdownChangeTutorHours option:selected').val();
        if (_gUser.stuId != null && reason && hours) {
            var bodyRequest = {
                clsId: parseInt(_gSelectedClsId),
                requester: _gUser.stuName,
                reason: reason,
                hours: parseInt(hours)
            };
            console.log(bodyRequest);
            $.ajax({
                type: "POST",
                url: _gServiceURL + "classrequest/requesttochangetutor/",
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(bodyRequest),
                crossDomain: true,
                dataType: "json",
                success: function (data, status, jqXHR) {
                    var alert;
                    var msg = data.message;
                    if (data.status == 200) {
                        alert = $(".alert-success");
                        $('#btnCreateRequest').hide();
                        $('#btnCancelClassBtStudent').hide();
                        $('#btnEvaluateTutor').hide();
                    } else {
                        alert = $(".alert-danger");
                    }
                    alert.find("strong").text(msg);
                    alert.show();
                },
                error: function (jqXHR, status) {
                    var alert = $(".alert-danger");
                    alert.find("strong").text(jqXHR);
                    alert.show();
                }
            });
        }
        $('#modalChangeTutor').modal('hide');
    }

    function initialEvaTutor() {
        /* 1. Visualizing things on Hover - See next part for action on click */
        $('#stars li').on('mouseover', function () {
            var onStar = parseInt($(this).data('value'), 10); // The star currently mouse on

            // Now highlight all the stars that's not after the current hovered star
            $(this).parent().children('li.star').each(function (e) {
                if (e < onStar) {
                    $(this).addClass('hover');
                }
                else {
                    $(this).removeClass('hover');
                }
            });

        }).on('mouseout', function () {
            $(this).parent().children('li.star').each(function (e) {
                $(this).removeClass('hover');
            });
        });


        /* 2. Action to perform on click */
        $('#stars li').on('click', function () {
            var onStar = parseInt($(this).data('value'), 10); // The star currently selected
            var stars = $(this).parent().children('li.star');

            for (i = 0; i < stars.length; i++) {
                $(stars[i]).removeClass('selected');
            }

            for (i = 0; i < onStar; i++) {
                $(stars[i]).addClass('selected');
            }
            var ratingValue = parseInt($('#stars li.selected').last().data('value'), 10);
            console.log(ratingValue);
            // JUST RESPONSE (Not needed)
            /*
            
            var msg = "";
            if (ratingValue > 1) {
                msg = "Thanks! You rated this " + ratingValue + " stars.";
            }
            else {
                msg = "We will improve ourselves. You rated this " + ratingValue + " stars.";
            }
            responseMessage(msg);
            */
        });
    }

    function responseMessage(msg) {
        //$('.success-box').fadeIn(200);
        //$('.success-box div.text-message').html("<span>" + msg + "</span>");
    }


</script>

</html>