<!DOCTYPE html>
<html>

<head>

</head>

<body>
    <div>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="javascript:loadMainPage();">หน้าหลัก</a>
            </li>
            <li class="breadcrumb-item active">สมัครเรียน</li>
        </ol>
    </div>
    <br>
    <div class="alert alert-dismissible alert-success" style="display: none;">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <strong>บันทึกข้อมูลสำเร็จ</strong>
    </div>
    <div class="alert alert-dismissible alert-danger" style="display: none;">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <strong>ไม่สามารถบันทึกข้อมูลได้</strong>
    </div>
    <div class="label-header">สมัครเรียน</div>
    <br>
    <div class="container-fluid">
        <div class="row" style="padding-left: 30px;">
            <div class="col-lg-12">
                <form class="form-horizontal">
                    <div class="form-group required">
                        <label for="dropdownType" class="col-lg-2 labelform">ประเภทสมาชิก</label>
                        <div class="col-lg-4">
                            <select class="custom-select" id="dropdownType">
                                <option value="S" selected="">นักเรียน</option>
                                <option value="P">ผู้ปกครอง</option>
                            </select>
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <br>
                    <div class="form-group required">
                        <label for="txtEmail" class="col-lg-2 labelform">อีเมล์</label>
                        <div class="col-lg-4">
                            <input type="text" class="form-control" id="txtEmail">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required">
                        <label for="txtNewPassword" class="col-lg-2 labelform">รหัสผ่านใหม่</label>
                        <div class="col-lg-4">
                            <input type="password" class="form-control" id="txtNewPassword">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required">
                        <label for="txtConfirmPassword" class="col-lg-2 labelform">ยืนยันรหัสผ่าน</label>
                        <div class="col-lg-4">
                            <input type="password" class="form-control" id="txtConfirmPassword">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="h2 inner-tab" style="margin-left:-30px;">ข้อมูลส่วนตัว</div>
                    <br>
                    <div class="form-group required" id="divFirstName">
                        <label for="txtFirstName" class="col-lg-2 labelform">ชื่อ</label>
                        <div class="col-lg-4">
                            <input type="text" class="form-control" id="txtFirstName">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required" id="divLastName">
                        <label for="txtLastName" class="col-lg-2 labelform">นามสกุล</label>
                        <div class="col-lg-4">
                            <input type="text" class="form-control" id="txtLastName">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group" id="divNickName">
                        <label for="txtNickname" class="col-lg-2">ชื่อเล่น</label>
                        <div class="col-lg-4">
                            <input type="text" class="form-control" id="txtNickname">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required" id="divTel">
                        <label for="txtTel" class="col-lg-2 labelform">เบอร์โทรมือถือ</label>
                        <div class="col-lg-4">
                            <input type="text" class="form-control" id="txtTel">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required" id="divSex">
                        <label for="dropdownSex" class="col-lg-2 labelform">เพศ</label>
                        <div class="col-lg-4">
                            <select class="custom-select" id="dropdownSex" required></select>
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required" id="divLevel">
                        <label for="dropdownLevel" class="col-lg-2 labelform">ระดับชั้น</label>
                        <div class="col-lg-4">
                            <select class="custom-select" id="dropdownLevel" required></select>
                        </div>
                        <div class="col-lg-6"></div>
                    </div>
                    <div class="form-group required" id="divSchool">
                        <label for="txtSchool" class="col-lg-2 labelform">สถานศึกษา</label>
                        <div class="col-lg-4">
                            <input type="text" class="form-control" id="txtSchool">
                        </div>
                        <div class="col-lg-6"></div>
                    </div>

                </form>
            </div>

        </div>
    </div>
    <br>
    <br>
    <br>
    <div class="container-center">
        <p>
            <button type="button" class="btn btn-primary btn-lg" id="btnSaveNewStudent">บันทึก</button>
            <button type="button" class="btn btn-secondary btn-lg">ยกเลิก</button>
        </p>
    </div>
</body>
<script>
    _isInitGmapStartAndEndPlace = false;
    var marker = null;
    var avatimes = [];

    /*----------- PAGE 1 -------------*/
    var dataSex = [{
        name: "ชาย", val: "M"
    }, {
        name: "หญิง", val: "F"
    }];
    for (var i = 0; i < dataSex.length; i++) {
        $('#dropdownSex').append('<option value="' + dataSex[i].val + '">' + dataSex[i].name + '</option>');
    }

    for (var i = 0; i < dataLevel.length; i++) {
        $('#dropdownLevel').append('<option value="' + dataLevel[i].val + '">' + dataLevel[i].name + '</option>');
    }

    $('#dropdownType').change(function () {
        var val = $('#dropdownType option:selected').val();
        console.log("dropdownType : ", val);
        if (val == 'P') {
            $('#divNickName').hide();
            $('#divLevel').hide();
            $('#divSchool').hide();
        } else {
            $('#divNickName').show();
            $('#divLevel').show();
            $('#divSchool').show();
        }
    });

    $("#btnSaveNewStudent").on("click", function (e) {
        var txtEmail = $('#txtEmail').val();
        var txtPassword = $('#txtNewPassword').val();
        var txtConfirmPassword = $('#txtConfirmPassword').val();
        var txtFirstName = $('#txtFirstName').val();
        var txtLastName = $('#txtLastName').val();
        var txtTel = $('#txtTel').val();
        var sex = $('#dropdownSex option:selected').val();
        var val = $('#dropdownType option:selected').val();
        console.log("dropdownType : ", val);

        // create new class
        if (txtPassword != txtConfirmPassword) {
            $(".alert-danger").find("strong").text('รหัสผ่านไม่ถูกต้อง');
            $(".alert-danger").show();
            $('html, body').animate({ scrollTop: $('.breadcrumb').offset().top }, 'fast');
        } else if (!txtEmail || !txtPassword || !txtFirstName || !txtLastName || !txtTel
            || !sex) {
            $(".alert-danger").find("strong").text('โปรดระบุข้อมูลให้ครบถ้วน');
            $(".alert-danger").show();
            $('html, body').animate({ scrollTop: $('.breadcrumb').offset().top }, 'fast');
        }
        else {
            if (val == 'P') {
                regisParent(txtEmail, txtPassword, txtFirstName, txtLastName, txtTel, sex);
            } else {
                var txtNickname = $('#txtNickname').val();
                var level = $('#dropdownLevel option:selected').val();
                var school = $('#txtSchool').val();
                registerStudent(txtEmail, txtPassword, txtFirstName, txtLastName, txtNickname, txtTel, sex, level, school);
            }

        }
    });

    function registerStudent(txtEmail, txtPassword, txtFirstName, txtLastName, txtNickname, txtTel, sex, level, school) {
        // if pass redirect to create class
        _gNewRegisStudent = 'Y';
        var bodyRequest = {
            stuEmail: txtEmail,
            stuPassword: txtPassword,
            stuFirstname: txtFirstName,
            stuLastname: txtLastName,
            stuNickname: txtNickname,
            stuPhonenum: txtTel,
            stuSex: sex,
            stuLevel: level,
            stuSchool: school,
        }
        console.log(bodyRequest);
        $.ajax({
            type: "POST",
            url: _gServiceURL + "student/registerstudent",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(bodyRequest),
            crossDomain: true,
            dataType: "json",
            success: function (data, status, jqXHR) {
                _gUserType = "student";
                _gHasClass = 'N';
                _gUser.stuId = data.data.stuId;
                _gUser.stuName = data.data.stuName;
                jQuery("#divShowUser").html(_gUser.stuName);
                console.log(_gUser.stuId);
                console.log(_gUser.stuName);
                loadMainPage();
            },
            error: function (jqXHR, status) {
                $(".alert-success").hide();
                $(".alert-danger").show();
                $('html, body').animate({ scrollTop: $('.breadcrumb').offset().top }, 'fast');
            }

        });
    }
    function regisParent(txtEmail, txtPassword, txtFirstName, txtLastName, txtTel, sex) {
        _gNewRegisStudent = 'Y';
        var bodyRequest = {
            parEmail: txtEmail,
            parPassword: txtPassword,
            parFirstname: txtFirstName,
            parLastname: txtLastName,
            parPhonenum: txtTel,
            parSex: sex
        }
        console.log(bodyRequest);
        $.ajax({
            type: "POST",
            url: _gServiceURL + "parent/register",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(bodyRequest),
            crossDomain: true,
            dataType: "json",
            success: function (data, status, jqXHR) {
                _gUserType = "parent";
                _gHasClass = 'N';
                _gUser.parId = data.data.parId;
                _gUser.parName = data.data.parName;
                jQuery("#divShowUser").html(_gUser.parName);
                console.log(_gUser.parId);
                console.log(_gUser.parName);
                loadMainPage();
            },
            error: function (jqXHR, status) {
                $(".alert-success").hide();
                $(".alert-danger").show();
                $('html, body').animate({ scrollTop: $('.breadcrumb').offset().top }, 'fast');
            }

        });
    }

</script>

</html>